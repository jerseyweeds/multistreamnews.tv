<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Stream Detector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        
        .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }
        
        .glass-effect {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .live-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-live {
            background-color: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }
        
        .status-offline {
            background-color: #6b7280;
        }
        
        .debug-console {
            background: #0f172a;
            border: 1px solid #374151;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .debug-console::-webkit-scrollbar {
            width: 6px;
        }
        
        .debug-console::-webkit-scrollbar-track {
            background: #1f2937;
        }
        
        .debug-console::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                Live Stream Detector
            </h1>
            <p class="text-gray-400">Detect and analyze live streaming videos from YouTube channels</p>
        </div>

        <!-- Input Section -->
        <div class="glass-effect rounded-xl p-6 mb-6">
            <div class="mb-4">
                <label for="channelUrl" class="block text-sm font-medium text-gray-300 mb-2">
                    YouTube Channel URL
                </label>
                <div class="flex gap-3">
                    <input 
                        type="text" 
                        id="channelUrl" 
                        value="https://www.youtube.com/@aljazeeraenglish/live"
                        placeholder="https://www.youtube.com/@channel/live"
                        class="flex-1 px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                    <button 
                        id="detectBtn" 
                        onclick="detectLiveStreams()"
                        class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 flex items-center gap-2"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a1 1 0 001-1V7a1 1 0 00-1-1H5a1 1 0 00-1 1v10a1 1 0 001 1z"></path>
                        </svg>
                        Detect Live Streams
                    </button>
                </div>
                <div class="text-xs text-gray-500 mt-2">
                    Supports: /live, /streams, /videos, or channel home pages
                </div>
            </div>

            <div class="flex items-center gap-4 text-sm">
                <label class="flex items-center gap-2">
                    <input type="checkbox" id="liveOnly" checked class="rounded bg-gray-700 border-gray-600">
                    <span class="text-gray-300">Live streams only</span>
                </label>
                <label class="flex items-center gap-2">
                    <input type="checkbox" id="includeMetadata" checked class="rounded bg-gray-700 border-gray-600">
                    <span class="text-gray-300">Include metadata</span>
                </label>
                <label class="flex items-center gap-2">
                    <input type="checkbox" id="showDebug" checked class="rounded bg-gray-700 border-gray-600">
                    <span class="text-gray-300">Show debug info</span>
                </label>
            </div>
        </div>

        <!-- Status Section -->
        <div id="statusSection" class="hidden glass-effect rounded-xl p-4 mb-6">
            <div class="flex items-center gap-3">
                <div id="statusIndicator" class="status-indicator"></div>
                <div>
                    <div id="statusTitle" class="font-medium"></div>
                    <div id="statusMessage" class="text-sm text-gray-400"></div>
                </div>
            </div>
        </div>

        <!-- Debug Console -->
        <div id="debugSection" class="glass-effect rounded-xl p-4 mb-6">
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-semibold">Debug Console</h3>
                <button onclick="clearDebug()" class="text-xs text-gray-400 hover:text-white">Clear</button>
            </div>
            <div id="debugConsole" class="debug-console mono-font text-xs p-4 rounded-lg">
                <div class="text-green-400">[SYSTEM] Live Stream Detector initialized</div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden glass-effect rounded-xl p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold">Live Streams Found</h3>
                <div class="flex items-center gap-4">
                    <span id="streamCount" class="text-sm text-gray-400">0 streams</span>
                    <button onclick="exportResults()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors">
                        Export CSV
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-700">
                            <th class="text-left py-3 px-2 text-sm font-medium text-gray-300">Status</th>
                            <th class="text-left py-3 px-2 text-sm font-medium text-gray-300">Title</th>
                            <th class="text-left py-3 px-2 text-sm font-medium text-gray-300">Channel</th>
                            <th class="text-left py-3 px-2 text-sm font-medium text-gray-300">Viewers</th>
                            <th class="text-left py-3 px-2 text-sm font-medium text-gray-300">Duration</th>
                            <th class="text-left py-3 px-2 text-sm font-medium text-gray-300">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTable">
                        <!-- Results will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Technical Information -->
        <div class="glass-effect rounded-xl p-6 mt-8">
            <h3 class="text-lg font-semibold mb-4">Technical Implementation</h3>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium text-blue-400 mb-2">Browser Limitations</h4>
                    <ul class="text-sm text-gray-300 space-y-1">
                        <li>• CORS policy blocks direct YouTube access</li>
                        <li>• JavaScript cannot fetch YouTube pages</li>
                        <li>• Browser security prevents scraping</li>
                        <li>• Need backend proxy or API</li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-medium text-green-400 mb-2">Backend Solutions</h4>
                    <ul class="text-sm text-gray-300 space-y-1">
                        <li>• Server-side YouTube page fetching</li>
                        <li>• YouTube Data API v3 integration</li>
                        <li>• Puppeteer/Playwright automation</li>
                        <li>• WebSocket live status updates</li>
                    </ul>
                </div>
            </div>
            
            <div class="mt-6 p-4 bg-yellow-900/20 border border-yellow-700 rounded-lg">
                <h4 class="font-medium text-yellow-400 mb-2">Detection Strategy</h4>
                <p class="text-sm text-gray-300">
                    To detect live streams, we need to parse YouTube's page HTML and look for:
                    <code class="mono-font text-yellow-300 bg-gray-800 px-1 rounded">{"isLiveNow":true}</code> indicators,
                    live badge elements, concurrent viewer counts, and streaming status metadata.
                </p>
            </div>
        </div>
    </div>

    <script>
        let debugEnabled = true;
        let foundStreams = [];

        function log(message, type = 'info') {
            if (!debugEnabled) return;
            
            const console = document.getElementById('debugConsole');
            const timestamp = new Date().toLocaleTimeString();
            
            let color = 'text-gray-300';
            let prefix = '[INFO]';
            
            switch (type) {
                case 'success':
                    color = 'text-green-400';
                    prefix = '[SUCCESS]';
                    break;
                case 'error':
                    color = 'text-red-400';
                    prefix = '[ERROR]';
                    break;
                case 'warning':
                    color = 'text-yellow-400';
                    prefix = '[WARNING]';
                    break;
                case 'debug':
                    color = 'text-blue-400';
                    prefix = '[DEBUG]';
                    break;
            }
            
            const logEntry = document.createElement('div');
            logEntry.className = color;
            logEntry.textContent = `[${timestamp}] ${prefix} ${message}`;
            
            console.appendChild(logEntry);
            console.scrollTop = console.scrollHeight;
        }

        function clearDebug() {
            document.getElementById('debugConsole').innerHTML = 
                '<div class="text-green-400">[SYSTEM] Debug console cleared</div>';
        }

        function showStatus(title, message, isLive = false) {
            const section = document.getElementById('statusSection');
            const indicator = document.getElementById('statusIndicator');
            const titleEl = document.getElementById('statusTitle');
            const messageEl = document.getElementById('statusMessage');
            
            section.classList.remove('hidden');
            
            if (isLive) {
                indicator.className = 'status-indicator status-live live-pulse';
                titleEl.className = 'font-medium text-red-400';
            } else {
                indicator.className = 'status-indicator status-offline';
                titleEl.className = 'font-medium text-gray-300';
            }
            
            titleEl.textContent = title;
            messageEl.textContent = message;
        }

        async function detectLiveStreams() {
            const url = document.getElementById('channelUrl').value.trim();
            const liveOnly = document.getElementById('liveOnly').checked;
            const includeMetadata = document.getElementById('includeMetadata').checked;
            
            if (!url) {
                log('No URL provided', 'error');
                showStatus('Error', 'Please enter a YouTube channel URL');
                return;
            }
            
            if (!url.includes('youtube.com')) {
                log('Invalid URL format', 'error');
                showStatus('Error', 'Please enter a valid YouTube URL');
                return;
            }
            
            log(`Starting live stream detection for: ${url}`, 'info');
            log(`Options: liveOnly=${liveOnly}, includeMetadata=${includeMetadata}`, 'debug');
            
            // Show what we're trying to do
            showStatus('Analyzing...', 'Attempting to detect live streams', true);
            
            try {
                // Parse channel info from URL
                const channelInfo = parseChannelUrl(url);
                log(`Channel: ${channelInfo.name || 'Unknown'}`, 'debug');
                log(`URL Type: ${channelInfo.type}`, 'debug');
                
                // Attempt to fetch (this will fail due to CORS)
                log('Attempting to fetch YouTube page...', 'info');
                await attemptDirectFetch(url);
                
            } catch (error) {
                log(`Detection failed: ${error.message}`, 'error');
                showStatus('CORS Blocked', 'Browser security prevents direct YouTube access');
                
                // Show alternative approaches
                showAlternativeApproaches();
            }
        }

        function parseChannelUrl(url) {
            const channelMatch = url.match(/@([^\/]+)/);
            const channelName = channelMatch ? channelMatch[1] : 'unknown';
            
            let type = 'unknown';
            if (url.includes('/live')) type = 'live-page';
            else if (url.includes('/streams')) type = 'streams-page';
            else if (url.includes('/videos')) type = 'videos-page';
            else if (url.includes('/@')) type = 'channel-handle';
            
            return { name: channelName, type };
        }

        async function attemptDirectFetch(url) {
            log('Sending fetch request to YouTube...', 'debug');
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36'
                    }
                });
                
                if (response.ok) {
                    const html = await response.text();
                    log('Successfully fetched YouTube page', 'success');
                    await parseYouTubePage(html);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                if (error.message.includes('CORS')) {
                    log('CORS policy blocked the request', 'warning');
                    throw new Error('CORS policy prevents direct access');
                } else {
                    log(`Network error: ${error.message}`, 'error');
                    throw error;
                }
            }
        }

        async function parseYouTubePage(html) {
            log('Parsing YouTube page HTML...', 'info');
            
            // Look for live stream indicators
            const liveIndicators = [
                /"isLiveNow":true/g,
                /"badge":{"liveBadgeRenderer"/g,
                /"concurrentViewers"/g,
                /"isLive":true/g
            ];
            
            let liveStreams = [];
            
            for (const pattern of liveIndicators) {
                const matches = html.match(pattern);
                if (matches) {
                    log(`Found ${matches.length} live indicators: ${pattern.source}`, 'debug');
                }
            }
            
            // Extract video data (simplified)
            const videoMatches = html.match(/"videoId":"([^"]+)"/g);
            if (videoMatches) {
                log(`Found ${videoMatches.length} video IDs`, 'debug');
                
                for (const match of videoMatches.slice(0, 5)) { // Limit for demo
                    const videoId = match.match(/"videoId":"([^"]+)"/)[1];
                    const streamData = await analyzeVideoForLiveStatus(videoId, html);
                    if (streamData) {
                        liveStreams.push(streamData);
                    }
                }
            }
            
            foundStreams = liveStreams;
            displayResults(liveStreams);
        }

        async function analyzeVideoForLiveStatus(videoId, html) {
            log(`Analyzing video ${videoId} for live status...`, 'debug');
            
            // Look for live indicators specific to this video
            const videoSection = extractVideoSection(html, videoId);
            
            if (!videoSection) {
                return null;
            }
            
            const isLive = videoSection.includes('"isLiveNow":true') || 
                          videoSection.includes('"badge":{"liveBadgeRenderer"') ||
                          videoSection.includes('"concurrentViewers"');
            
            if (isLive) {
                log(`Video ${videoId} is LIVE`, 'success');
                
                return {
                    videoId,
                    url: `https://www.youtube.com/watch?v=${videoId}`,
                    title: extractTitle(videoSection) || 'Live Stream',
                    channel: extractChannel(videoSection) || 'Unknown Channel',
                    viewers: extractViewers(videoSection) || 'Unknown',
                    duration: 'LIVE',
                    isLive: true,
                    detectedAt: new Date().toISOString()
                };
            }
            
            return null;
        }

        function extractVideoSection(html, videoId) {
            // Find the section of HTML containing this video's data
            const videoIndex = html.indexOf(`"videoId":"${videoId}"`);
            if (videoIndex === -1) return null;
            
            // Extract surrounding context (simplified)
            const start = Math.max(0, videoIndex - 1000);
            const end = Math.min(html.length, videoIndex + 2000);
            
            return html.substring(start, end);
        }

        function extractTitle(section) {
            const titleMatch = section.match(/"title":"([^"]+)"/);
            return titleMatch ? titleMatch[1] : null;
        }

        function extractChannel(section) {
            const channelMatch = section.match(/"channelName":"([^"]+)"|"author":"([^"]+)"/);
            return channelMatch ? (channelMatch[1] || channelMatch[2]) : null;
        }

        function extractViewers(section) {
            const viewerMatch = section.match(/"concurrentViewers":"([^"]+)"/);
            return viewerMatch ? viewerMatch[1] : null;
        }

        function displayResults(streams) {
            const section = document.getElementById('resultsSection');
            const table = document.getElementById('resultsTable');
            const count = document.getElementById('streamCount');
            
            if (streams.length === 0) {
                section.classList.add('hidden');
                showStatus('No Live Streams', 'No live streams detected on this channel');
                return;
            }
            
            section.classList.remove('hidden');
            count.textContent = `${streams.length} stream${streams.length !== 1 ? 's' : ''}`;
            
            table.innerHTML = streams.map(stream => `
                <tr class="border-b border-gray-700 hover:bg-gray-800/50">
                    <td class="py-3 px-2">
                        <div class="flex items-center gap-2">
                            <div class="status-indicator status-live live-pulse"></div>
                            <span class="text-red-400 font-medium text-sm">LIVE</span>
                        </div>
                    </td>
                    <td class="py-3 px-2">
                        <div class="font-medium">${stream.title}</div>
                        <div class="text-xs text-gray-400">ID: ${stream.videoId}</div>
                    </td>
                    <td class="py-3 px-2">
                        <div class="text-blue-400">${stream.channel}</div>
                    </td>
                    <td class="py-3 px-2">
                        <div class="text-sm">${stream.viewers}</div>
                        <div class="text-xs text-gray-400">watching</div>
                    </td>
                    <td class="py-3 px-2">
                        <span class="text-red-400 font-medium">${stream.duration}</span>
                    </td>
                    <td class="py-3 px-2">
                        <button onclick="window.open('${stream.url}', '_blank')" 
                                class="text-blue-400 hover:text-blue-300 text-sm font-medium">
                            Watch
                        </button>
                    </td>
                </tr>
            `).join('');
            
            showStatus('Live Streams Found', `Detected ${streams.length} active live stream${streams.length !== 1 ? 's' : ''}`, true);
            log(`Displayed ${streams.length} live streams in results table`, 'success');
        }

        function showAlternativeApproaches() {
            log('=== ALTERNATIVE APPROACHES ===', 'info');
            log('1. Backend Proxy: Create server endpoint to fetch YouTube pages', 'info');
            log('2. YouTube Data API: Use official Google API with authentication', 'info');
            log('3. Browser Automation: Use Puppeteer/Playwright for scraping', 'info');
            log('4. WebSocket Updates: Real-time live status monitoring', 'info');
            log('5. Browser Extension: Can bypass CORS restrictions', 'info');
            
            // Show example backend implementation
            log('=== EXAMPLE BACKEND CODE ===', 'debug');
            log('app.get("/api/live-streams", async (req, res) => {', 'debug');
            log('  const url = req.query.url;', 'debug');
            log('  const response = await fetch(url);', 'debug');
            log('  const html = await response.text();', 'debug');
            log('  const streams = parseLiveStreams(html);', 'debug');
            log('  res.json(streams);', 'debug');
            log('});', 'debug');
        }

        function exportResults() {
            if (foundStreams.length === 0) {
                log('No streams to export', 'warning');
                return;
            }
            
            const csv = [
                'VideoID,Title,Channel,URL,Viewers,Status,DetectedAt',
                ...foundStreams.map(stream => 
                    `"${stream.videoId}","${stream.title}","${stream.channel}","${stream.url}","${stream.viewers}","LIVE","${stream.detectedAt}"`
                )
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `live-streams-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('CSV export completed', 'success');
        }

        // Event listeners
        document.getElementById('showDebug').addEventListener('change', (e) => {
            debugEnabled = e.target.checked;
            document.getElementById('debugSection').classList.toggle('hidden', !debugEnabled);
        });

        // Initialize
        log('Ready to detect live streams', 'success');
        log('Enter a YouTube channel URL and click "Detect Live Streams"', 'info');
    </script>
</body>
</html>
